# 映射
- 映射是一种将数据结构与索引相关联的机制。它指定了存储在索引中的文档的字段类型和其他属性，例如是否为必需字段、是否允许空值等。映射还可以设置数据类型（例如字符串、整数、日期等）​，以及设置如何处理数据（例如是否分词或如何分词）。
## 组成部分
### 元字段
- 元字段用于自定义关于处理文档的相关元数据
- 标识元字段
  - _index：表示文档所属的索引
  - _id：表示文档的ID
- 文档源元字段
  - _source：表示代表文档正文的原始JSON对象
  - _size：表示source字段的大小（以字节为单位）​。
- 索引元字段
  - _field_names：表示给定文档中包含非空值的所有字段
  - _ignored：表示由于设置ignore_malformed而在索引时被忽略的字段
- 路由元字段
  - _routing：用于将给定文档路由到指定的分片
- 其他元字段
  - _meta：表示应用程序特定的元数据，通俗地解读为可用于给索引加必要注释信息
  - _tier：指定文档所属索引的数据层级别，如在查询文档时可以指定data_hot、data_warm、data_cold等

### 数据类型字段
- 基本数据类型
  - binary：编码为Base64字符串的二进制类型
  - boolean：仅支持true和false的布尔类型
  - keyword：支持精准匹配的keyword类型、const_keyword类型和wildcard类型
  - number：数值类型，如integer、long、float、double等
  - date：日期类型，包括date和date_nanos
  - alias：别名类型，区别于索引别名，此处的别名是字段级别的别名
  - text：全文检索类型
- 复杂数据类型
  - 数组类型：Array
  - JSON对象类型：Object
  - 嵌套数据类型：Nested
  - 父子关联类型：Join
  - Flattened类型：将原来一个复杂的Object或者Nested嵌套多字段类型统一映射为扁平的单字段类型
- 专用数据类型
  - 坐标数据类型：用于保存地理位置详细信息
  - IP类型：表示IPV4或IPV6地址
  - completion类型：是Elasticsearch中的一种专用字段类型，旨在实现高效的自动补全功能
- 多字段类型
  - 允许用户对单个文档字段设定多种不同的数据类型，以满足不同查询需求

## 映射类型
### 动态映射
- 动态映射的核心是在自动检测字段类型后添加新字段
- 支持字段类型：boolean类型、float类型、long类型、Object类型、Array类型、date类型、字符串类型
- 弊端
  - 字段匹配不准确
  - 字段匹配不精准
  - 占据多余的存储空间
  - 映射可能错误泛滥
### 静态映射
- 我们在数据建模前，需要明确文档中各个字段的类型
- 将dynamic参数设置为false（表示忽略新字段）​，或者将dynamic参数设置为strict（表示如果遇到未知字段，则引发异常）​。

### 映射可以更新么?
- 已经定义的字段在大多数情况下不能更新, 除非通过reindex操作来更新映射
- 可以更新的情况
    - Object对象可以添加新的属性
    - 在已经存在的字段里面可以添加fields，以构成一个字段多种类型
    - ignore_above是可以更新的

### Nested类型及应用
